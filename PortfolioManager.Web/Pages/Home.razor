@page "/"
@using PortfolioManager.Contracts
@using PortfolioManager.Contracts.Web
@using PortfolioManager.Contracts.Models.Brokerage
@using PortfolioManager.Web.Components
@using AggregatedHoldingsTable = PortfolioManager.Web.Components.ViewModels.AggregatedHoldingsTable
@using DetailedHoldingsTable = PortfolioManager.Web.Components.ViewModels.DetailedHoldingsTable

<PageTitle>Dashboard</PageTitle>

<TimeAndMarketStatusCard 
    LocalTime="@_localTime"
    LocalTimeZone="@_localTimeZone"
    NyseTime="@_nyseTime"
    MarketStatus="@_marketStatus" />

<DashboardHeader 
    Currency="@GetPortfolioCurrency()"
    OnRefresh="@RefreshPortfolio" />

@if (!_isLoggedIn)
{
    <MudCard Elevation="2" Class="pa-4 mb-4">
        <MudCardContent>
            @if (_demoMode)
            {
                <MudAlert Severity="Severity.Success" Class="mb-3" Dense="true" Icon="@Icons.Material.Filled.Info">
                    <strong>Demo Mode Active:</strong> This is a sample portfolio with demo data. Login with any credentials to explore!
                </MudAlert>
            }
            <MudText Typo="Typo.h6" Class="mb-3">Connect Your Sharesies Account</MudText>
            <MudButton Variant="Variant.Filled" Class="sharesies-login-btn" OnClick="ShowLoginDialog">
                <img src="images/sharesies-logo.png" alt="@Constants.BrokerageSharesies" class="mr-2" />
                @(_demoMode ? "Try Demo Login" : "Login with Sharesies")
            </MudButton>
        </MudCardContent>
    </MudCard>
}
else if (_isLoading)
{
    <MudProgressCircular Indeterminate="true" />
    <MudText>Loading portfolio data...</MudText>
}
else if (_portfolioData != null)
{
    <PortfolioStatsCards 
        TotalValue="@GetTotalValue()"
        DailyReturn="@GetDailyReturn()"
        DailyReturnPercentage="@GetDailyReturnPercentage()"
        HoldingsCount="@GetHoldingsCount()" />

    <MudItem xs="12" Class="mt-4">
        <AggregatedHoldingsTable Holdings="@GetAggregatedHoldings()" />
        
        <DetailedHoldingsTable Holdings="@GetHoldings()" />
    </MudItem>
}
