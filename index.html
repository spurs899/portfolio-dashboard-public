<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Hedgey</title>
    <base href="/portfolio-dashboard-public/" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="images/hedgey-logo-green.png" />
    <link rel="apple-touch-icon" href="images/hedgey-logo-green-squared.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#15171c" />
    <link href="PortfolioManager.Web.styles.css?v=20260202.1153" rel="stylesheet" />
    <link href="css/app.css?v=20260202.1153" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div class="app-loading">
            <div class="loading-container">
                <div class="loading-logo-wrapper">
                    <img src="images/hedgey-logo-green.png" alt="Hedgey" class="loading-sloth" />
                </div>
                <div class="loading-banner-wrapper">
                    <img src="images/hedgey-text.svg" alt="Hedgey" class="loading-banner-text" />
                </div>
                <div class="loading-text">
                    Loading
                    <span class="loading-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </div>
                <div class="loading-subtitle">Rustling in the hedges</div>
            </div>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>
    <script src="_framework/blazor.webassembly.js?v=20260202.1153" autostart="false"></script>
    <script>
        // GitHub Pages SPA routing fix - restore redirected URL
        (function() {
            var redirect = sessionStorage.redirect;
            delete sessionStorage.redirect;
            if (redirect && redirect != location.href) {
                history.replaceState(null, null, redirect);
            }
        })();
        
        // Service Worker Management - Force update on new version
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
        
        // Cache busting - Clear application cache on version change
        const APP_VERSION = '20260202.1153';
        const storedVersion = localStorage.getItem('app_version');
        
        if (storedVersion !== APP_VERSION) {
            // Clear all caches
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                    });
                });
            }
            
            // Clear localStorage except version
            const keysToPreserve = ['app_version'];
            for (let i = localStorage.length - 1; i >= 0; i--) {
                const key = localStorage.key(i);
                if (key && !keysToPreserve.includes(key)) {
                    localStorage.removeItem(key);
                }
            }
            
            // Update version
            localStorage.setItem('app_version', APP_VERSION);
            console.log('App updated to version:', APP_VERSION);
        }
        
        // Start Blazor after cache management
        Blazor.start();
    </script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
</body>
</html>